ORG 00H
;----------------LAB4----------------------
;PART B
MOV TMOD,#11H ;TIMER 0 AND 1 ;MODE 1
MOV 7,#25	; 25 TIMES
MOV 6,#80H	;OFFSET
;MOV 5,#0
MOV 4,#0	;COUNTING DPTR VALUE

MOV DPTR,#LOOKUP ;TO LOOKUP TABLE
;LOOKING DPTR VALUE IF IT IS 250 RESET SYSTEM
IF250:		CLR C
		MOV A,4
		CJNE A,#250,BEGIN
		CLR C
		MOV 4,#0	;USING CLR 4 IS MAKING SIGNAL DISTORTION
		MOV DPTR,#LOOKUP
BEGIN:		CLR C
		MOV 7,#25
		MOV DPTR,#LOOKUP
START:
		CLR A
		ADD A,4
		MOVC A,@A+DPTR
		INC DPTR
;		INC 5
		ADD A,30H	
		MOV 30H,A	
		DJNZ 7,START	;REPEAT IT 25 TIMES
		INC 4
		ACALL ADDOFFSET	;ADDING OFFSET VALUE
		MOV P2,A
		ACALL DELAY2MS	
		CLR A
		MOV 30H,#0
		SJMP IF250

RETURN:
		RET
ADDOFFSET:	CLR C
		CJNE A,6,$+3
		JNC NEG
		CLR C
		ADD A,6
		SJMP RETURN
NEG:		CLR C	
		CPL A	;TWOS COMPLEMENT
		INC A
		XCH A,B
		MOV A,6
		SUBB A,B
		SJMP RETURN
DELAY2MS:	;MADE LITTLE ADJUSTMENT IN DELAY IT IS NOT EXACTLY 2MS
		MOV TH1, #0F9H	;NOW IT IS ALMOST 500MS
		MOV TL1, #0DFH
		NOP
		SETB TR1
AGAIN:		JNB TF1, AGAIN
		CLR TR1	
		CLR TF1	
		SJMP RETURN
ORG 500H
LOOKUP: DB  00H, 02H, 03H, 03H, 03H, 02H, 01H, 00H, 0FEH, 0FEH, 0FEH, 0FFH, 01H, 02H, 03H, 04H, 04H, 04H, 03H, 01H, 00H, 0FFH, 0FFH, 00H, 01H, 03H, 04H, 05H, 06H, 05H, 04H, 03H, 02H, 01H, 00H, 00H, 01H, 03H, 04H, 06H, 06H, 06H, 06H, 04H, 03H, 02H, 01H, 01H, 01H, 03H, 04H, 06H, 07H, 07H, 06H, 05H, 04H, 03H, 01H, 01H, 01H, 02H, 04H, 05H, 06H, 07H, 07H, 06H, 05H, 03H, 02H, 01H, 01H, 02H, 03H, 04H, 06H, 06H, 07H, 06H, 05H, 03H, 02H, 01H, 00H, 01H, 02H, 03H, 04H, 06H, 06H, 06H, 05H, 03H, 02H, 01H, 00H, 00H, 00H, 02H, 03H, 04H, 05H, 05H, 04H, 03H, 02H, 00H, 0FFH, 0FFH, 0FFH, 00H, 01H, 03H, 04H, 04H, 04H, 03H, 01H, 0FFH, 0FEH, 0FDH, 0FDH, 0FEH, 0FFH, 01H, 02H, 03H, 03H, 02H, 01H, 0FFH, 0FDH, 0FCH, 0FCH, 0FCH, 0FDH, 0FFH, 00H, 01H, 01H, 01H, 00H, 0FEH, 0FDH, 0FCH, 0FBH, 0FBH, 0FCH, 0FDH, 0FEH, 00H, 00H, 00H, 0FFH, 0FEH, 0FDH, 0FBH, 0FAH, 0FAH, 0FAH, 0FCH, 0FDH, 0FEH, 0FFH, 00H, 0FFH, 0FEH, 0FDH, 0FBH, 0FAH, 0F9H, 0FAH, 0FAH, 0FCH, 0FDH, 0FEH, 0FFH, 0FFH, 0FEH, 0FDH, 0FBH, 0FAH, 0F9H, 0F9H, 0FAH, 0FBH, 0FCH, 0FEH, 0FFH, 0FFH, 0FFH, 0FDH, 0FCH, 0FBH, 0FAH, 0F9H, 0F9H, 0FAH, 0FCH, 0FDH, 0FFH, 0FFH, 0FFH, 0FEH, 0FDH, 0FCH, 0FAH, 0FAH, 0FAH, 0FAH, 0FCH, 0FDH, 0FFH, 00H, 00H, 0FFH, 0FEH, 0FDH, 0FCH, 0FBH, 0FAH, 0FBH, 0FCH, 0FDH, 0FFH, 00H, 01H, 01H, 00H, 0FFH, 0FDH, 0FCH, 0FCH, 0FCH, 0FDH, 0FEH, 0FFH, 01H, 02H, 02H, 02H, 00H, 0FFH, 0FEH, 0FDH, 0FDH, 0FDH, 0FEH, 00H,00H, 02H, 03H, 03H, 03H, 02H, 01H, 00H, 0FEH, 0FEH, 0FEH, 0FFH, 01H, 02H, 03H, 04H, 04H, 04H, 03H, 01H, 00H, 0FFH, 0FFH, 00H, 01H, 03H, 04H, 05H, 06H, 05H, 04H, 03H, 02H, 01H, 00H, 00H, 01H, 03H, 04H, 06H, 06H, 06H, 06H, 04H, 03H, 02H, 01H, 01H, 01H, 03H, 04H, 06H, 07H, 07H, 06H, 05H, 04H, 03H, 01H, 01H, 01H, 02H, 04H, 05H, 06H, 07H, 07H, 06H, 05H, 03H, 02H, 01H, 01H, 02H, 03H, 04H, 06H, 06H, 07H, 06H, 05H, 03H, 02H, 01H, 00H, 01H, 02H, 03H, 04H, 06H, 06H, 06H, 05H, 03H, 02H, 01H, 00H, 00H, 00H, 02H, 03H, 04H, 05H, 05H, 04H, 03H, 02H, 00H, 0FFH, 0FFH, 0FFH, 00H, 01H, 03H, 04H, 04H, 04H, 03H, 01H, 0FFH, 0FEH, 0FDH, 0FDH, 0FEH, 0FFH, 01H, 02H,03H, 03H, 02H, 01H, 0FFH, 0FDH, 0FCH, 0FCH, 0FCH, 0FDH, 0FFH, 00H, 01H, 01H, 01H, 00H, 0FEH, 0FDH, 0FCH, 0FBH, 0FBH, 0FCH, 0FDH, 0FEH, 00H, 00H, 00H, 0FFH, 0FEH, 0FDH, 0FBH, 0FAH, 0FAH, 0FAH, 0FCH, 0FDH, 0FEH, 0FFH, 00H, 0FFH, 0FEH
;PASTED MORE DATA FOR PRECISE SIGNAL
END
